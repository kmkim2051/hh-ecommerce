# 이커머스 시스템 동시성 문제 분석 보고서

## 1. 개요

- 본 보고서는 이커머스 시스템에서 발생할 수 있는 동시성 문제를 식별하고, 각 시나리오별로 적절한 해결 방안을 제시한다.
- 서비스는 제품 출시 초기 상황을 가정한다.
    - 적은 트래픽
    - 적은 자본 (포인트, 쿠폰 금액 등 금전적 이슈의 민감도 높음)
    - 추후 확장 가능성 고려해야 함
## 2. 주요 동시성 문제 발생 영역

- 쿠폰: 쿠폰 발급 및 사용
- 포인트: 포인트 충전 및 사용
- 상품: 재고 차감

## 3. 상세 분석 및 해결 방안

### 3.1 쿠폰

**쿠폰 발급**

- 시나리오: 특정 시간 선착순 n개 쿠폰 발급
- 충돌 가능성: 높음
- 위험도: 쿠폰 초과 발급 시 초기 서비스에서의 금전적 손해 및 서비스 신뢰도 하락
- 해결 방안: 비관적 락 적용
- 향후 개선: 트래픽 증가 시 낙관적 락 또는 분산 락으로 전환 검토

**쿠폰 사용**

- 시나리오: 사용자 본인의 쿠폰 정보 접근
- 충돌 가능성: 낮음
- 해결 방안: 낙관적 락 적용 (서비스 안정성 확보)

### 3.2 포인트

**포인트 충전**

- 시나리오: 사용자 본인의 포인트 정보 접근
- 충돌 가능성: 낮음 (다양한 결제 수단 중 하나)
- 해결 방안: 낙관적 락 적용 (이중 충전 방지)

**포인트 사용**

- 시나리오: 사용자 본인의 포인트 정보 접근
- 충돌 가능성: 낮음 (다양한 결제 수단 중 하나)
- 해결 방안: 낙관적 락 적용 (이중 사용 방지)

### 3.3 상품

**재고 차감**

- 시나리오: 동일 상품에 대한 다수 사용자의 동시 구매
- 충돌 가능성: 높음 (특히 한정 수량 이벤트 상품)
- 위험도: 재고 초과 판매, 주문 처리 불일치 시 고객 불만 및 금전적 손실
- 해결 방안: 비관적 락 적용 (안정성 우선)

## 4. 동시성 제어 방식 요약

| 도메인 | 기능 | 제어 방식 | 선택 사유 |
|--------|------|-----------|-----------|
| 쿠폰 | 쿠폰 발급 | 비관적 락 | 선착순 쿠폰 발급 시 충돌 가능성 높음. 초과 발급 시 금전적 손해 및 서비스 신뢰도 하락 위험이 커 안정성 우선 |
| 쿠폰 | 쿠폰 사용 | 낙관적 락 | 본인 쿠폰 정보 접근으로 충돌 가능성 낮음. 서비스 안정성 확보 목적 |
| 포인트 | 포인트 충전 | 낙관적 락 | 본인 포인트 정보 접근, 다양한 결제 수단 중 하나로 충돌 가능성 낮음. 이중 충전 방지 목적 |
| 포인트 | 포인트 사용 | 낙관적 락 | 본인 포인트 정보 접근, 다양한 결제 수단 중 하나로 충돌 가능성 낮음. 이중 사용 방지 목적 |
| 상품 재고 | 재고 차감 | 비관적 락 | 동일 상품 다수 동시 구매로 충돌 가능성 높음. 재고 초과 판매 시 위험도가 높아 성능보다 안정성 우선 |

## 5. 결론

- 각 도메인의 특성과 위험도를 고려하여 적절한 동시성 제어 방식을 선택했다. 
- 충돌 가능성이 높고 데이터 정합성이 중요한 쿠폰 발급과 재고 차감은 비관적 락을 적용
- 충돌 가능성이 낮은 쿠폰 사용 및 포인트 관련 기능은 낙관적 락을 적용하여 성능과 안정성의 균형을 확보했다. 
- 향후 서비스 규모와 트래픽 패턴 변화에 따라 락 전략을 유연하게 조정할 필요가 있다.
