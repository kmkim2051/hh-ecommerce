# E-Commerce ERD

```mermaid
---
config:
  theme: neutral
---
erDiagram
    USER ||--o| POINT : ""
    USER ||--o{ CART_ITEM : has
    USER ||--o{ ORDER : ""
    USER ||--o{ COUPON_USER : ""
    POINT ||--o{ POINT_TRANSACTION : ""
    PRODUCT ||--o{ CART_ITEM : ""
    PRODUCT ||--o{ ORDER_ITEM : "ordered as"
    ORDER ||--|{ ORDER_ITEM : contains
    ORDER ||--o{ COUPON_USER : "uses coupon"
    ORDER ||--o{ POINT_TRANSACTION : ""
    COUPON ||--o{ COUPON_USER : "issued to"
    USER {
        bigint id PK
        varchar nickname
        datetime created_at
    }
    POINT {
        bigint id PK
        bigint user_id FK "unique"
        decimal balance "현재 잔액"
        datetime updated_at
    }
    POINT_TRANSACTION {
        bigint id PK
        bigint point_id FK
        decimal amount "always positive"
        varchar type "CHARGE, USE, REFUND"
        bigint order_id FK "nullable"
        decimal balance_after "트랜잭션 후 잔액"
        datetime created_at
    }
    PRODUCT {
        bigint id PK
        varchar name
        text description
        decimal price
        int stock_quantity
    }
    CART_ITEM {
        bigint id PK
        bigint user_id FK
        bigint product_id FK
        int quantity
        datetime created_at
    }
    ORDER {
        bigint id PK
        bigint user_id FK
        varchar status "PENDING, PAID, COMPLETED, CANCELED"
        decimal total_price
        datetime order_date
    }
    ORDER_ITEM {
        bigint id PK
        bigint order_id FK
        bigint product_id FK
        varchar product_name "snapshot"
        decimal price "snapshot"
        int quantity
        varchar status "NORMAL, CANCELED"
    }
    COUPON {
        bigint id PK
        varchar name
        decimal discount_amount
        int total_quantity
        int available_quantity
        varchar status "ACTIVE, SOLD_OUT, EXPIRED, DISABLED"
        datetime start_date
        datetime end_date
        datetime created_at
    }
    COUPON_USER {
        bigint id PK
        bigint user_id FK
        bigint coupon_id FK
        bigint order_id FK "nullable"
        datetime issued_at
        datetime used_at "nullable"
        datetime expire_date
        boolean is_used
    }

    OUTBOX_EVENT {
        bigint id PK
        bigint order_id FK
        datetime created_at
    }

```
#### 01. USER
- 서비스 사용자 정보 테이블
- 닉네임, 생성일 등을 관리

#### 02. POINT
- 사용자별 포인트 계좌 (1:1 관계)
- 현재 잔액과 최근 업데이트 일시 저장

#### 03. POINT_TRANSACTION
- 포인트 거래 내역
- 충전/사용/환불 타입 구분 및 잔액 이력 추적

#### 04. PRODUCT
- 판매 상품 정보
- 이름, 설명, 가격, 재고 수량 등 관리

#### 05. CART_ITEM
- 장바구니 아이템 테이블
- 사용자별 담긴 상품과 수량 기록

#### 06. ORDER
- 주문 메인 테이블
- 주문 상태, 총 금액, 주문일 등 포함

#### 07. ORDER_ITEM
- 주문 상세 아이템 테이블
- 주문 당시 상품명/가격을 스냅샷 형태로 저장

#### 08. COUPON
- 발행 가능한 쿠폰 정보
- 수량, 기간, 상태 등 관리

#### 09. COUPON_USER
- 사용자별 쿠폰 발급/사용 이력
- 사용 여부 및 만료일 관리

#### 10. OUTBOX_EVENT
- 주문 관련 이벤트 발행 내역 저장 (이벤트 소싱용)