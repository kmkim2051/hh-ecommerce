# User Stories

## Epic 1: 포인트 관리

### US-P-001: 포인트 충전
**As a** 고객  
**I want** 포인트를 충전할 수 있기를  
**So that** 상품 구매 시 결제 수단으로 사용할 수 있다

**Acceptance Criteria:**
- [ ] 충전 금액을 입력하면 내 포인트 잔액이 증가한다
- [ ] 충전 후 잔액과 충전 이력이 확인 가능하다
- [ ] 0 이하의 금액은 충전할 수 없다
- [ ] 충전 성공 시 즉시 사용 가능하다

---

### US-P-002: 포인트 잔액 조회
**As a** 고객  
**I want** 현재 포인트 잔액을 조회할 수 있기를  
**So that** 구매 가능한 금액을 확인할 수 있다

**Acceptance Criteria:**
- [ ] 내 현재 포인트 잔액을 실시간으로 확인할 수 있다
- [ ] 잔액 정보는 정확하게 표시된다

---

### US-P-003: 포인트 거래 내역 조회
**As a** 고객  
**I want** 포인트 충전/사용/환불 내역을 조회할 수 있기를  
**So that** 포인트 변동 이력을 확인할 수 있다

**Acceptance Criteria:**
- [ ] 충전, 사용, 환불 내역을 구분하여 볼 수 있다
- [ ] 각 거래의 금액, 시간, 거래 후 잔액을 확인할 수 있다
- [ ] 관련된 주문이 있다면 함께 표시된다

---

## Epic 2: 쿠폰 관리

### US-C-001: 선착순 쿠폰 발급
**As a** 고객  
**I want** 선착순 쿠폰을 발급받을 수 있기를  
**So that** 주문 시 할인 혜택을 받을 수 있다

**Acceptance Criteria:**
- [ ] 발급 가능한 쿠폰 목록을 확인할 수 있다
- [ ] 쿠폰 발급 버튼을 클릭하면 즉시 발급된다
- [ ] 수량이 소진된 쿠폰은 발급할 수 없다
- [ ] 동일 쿠폰을 중복 발급할 수 없다
- [ ] 동시에 여러 사용자가 발급 요청해도 정확한 수량만 발급된다

---

### US-C-002: 보유 쿠폰 조회
**As a** 고객  
**I want** 내가 보유한 쿠폰 목록을 조회할 수 있기를  
**So that** 사용 가능한 쿠폰을 확인하고 주문에 적용할 수 있다

**Acceptance Criteria:**
- [ ] 미사용 쿠폰만 필터링하여 볼 수 있다
- [ ] 각 쿠폰의 할인 금액과 만료일을 확인할 수 있다
- [ ] 만료된 쿠폰과 사용된 쿠폰을 구분할 수 있다

---

## Epic 3: 상품 관리

### US-PR-001: 상품 목록 조회
**As a** 고객  
**I want** 판매 중인 상품 목록을 조회할 수 있기를  
**So that** 구매할 상품을 선택할 수 있다

**Acceptance Criteria:**
- [ ] 상품 이름, 가격, 재고 정보를 확인할 수 있다
- [ ] 재고가 있는 상품만 구매 가능하다
- [ ] 여러 상품을 비교하여 선택할 수 있다

---

### US-PR-002: 상품 상세 조회
**As a** 고객  
**I want** 특정 상품의 상세 정보를 조회할 수 있기를  
**So that** 상품에 대한 자세한 정보를 확인할 수 있다

**Acceptance Criteria:**
- [ ] 상품의 이름, 설명, 가격, 재고를 확인할 수 있다
- [ ] 상품 정보는 항상 최신 상태로 표시된다

---

### US-PR-003: 실시간 재고 조회
**As a** 고객  
**I want** 상품의 현재 재고를 실시간으로 조회할 수 있기를  
**So that** 구매 가능 여부를 정확히 판단할 수 있다

**Acceptance Criteria:**
- [ ] 상품의 현재 재고 수량을 확인할 수 있다
- [ ] 재고 정보는 실시간으로 업데이트된다
- [ ] 재고가 0인 경우 품절 상태를 명확히 표시한다

---

## Epic 4: 장바구니 관리

### US-CA-001: 장바구니 상품 추가
**As a** 고객  
**I want** 상품을 장바구니에 담을 수 있기를  
**So that** 여러 상품을 모아서 한번에 주문할 수 있다

**Acceptance Criteria:**
- [ ] 원하는 상품과 수량을 장바구니에 추가할 수 있다
- [ ] 재고보다 많은 수량은 담을 수 없다
- [ ] 장바구니에 담은 상품은 즉시 확인 가능하다

---

### US-CA-002: 장바구니 수량 변경
**As a** 고객  
**I want** 장바구니에 담긴 상품의 수량을 변경할 수 있기를  
**So that** 구매할 수량을 조정할 수 있다

**Acceptance Criteria:**
- [ ] 장바구니 상품의 수량을 증가/감소할 수 있다
- [ ] 변경하려는 수량이 재고보다 많으면 변경할 수 없다
- [ ] 수량 변경 후 즉시 반영된다

---

### US-CA-003: 장바구니 상품 삭제
**As a** 고객  
**I want** 장바구니에서 상품을 삭제할 수 있기를  
**So that** 구매하지 않을 상품을 제거할 수 있다

**Acceptance Criteria:**
- [ ] 장바구니에서 원하는 상품을 삭제할 수 있다
- [ ] 삭제된 상품은 즉시 목록에서 제거된다

---

### US-CA-004: 장바구니 조회
**As a** 고객  
**I want** 장바구니에 담긴 상품 목록을 조회할 수 있기를  
**So that** 주문 전에 담은 상품들을 확인할 수 있다

**Acceptance Criteria:**
- [ ] 장바구니에 담긴 모든 상품을 확인할 수 있다
- [ ] 각 상품의 이름, 가격, 수량이 표시된다
- [ ] 예상 총 금액을 확인할 수 있다

---

## Epic 5: 주문 및 결제

### US-O-001: 주문 생성 (핵심)
**As a** 고객  
**I want** 장바구니 상품을 주문하고 포인트로 결제할 수 있기를  
**So that** 상품을 구매할 수 있다

**Acceptance Criteria:**
- [ ] 장바구니에 담긴 모든 상품을 한번에 주문할 수 있다
- [ ] 보유한 쿠폰을 선택하여 할인을 적용할 수 있다
- [ ] 포인트 잔액이 부족하면 주문할 수 없다
- [ ] 재고가 부족한 상품이 있으면 전체 주문이 실패한다
- [ ] 주문 성공 시 재고가 차감되고 포인트가 차감된다
- [ ] 주문 완료 후 장바구니는 비워진다
- [ ] 주문 시점의 상품명과 가격이 주문 내역에 저장된다

---

### US-O-002: 주문 목록 조회
**As a** 고객  
**I want** 내 주문 목록을 조회할 수 있기를  
**So that** 과거 주문 내역을 확인할 수 있다

**Acceptance Criteria:**
- [ ] 모든 주문 내역을 시간 순으로 볼 수 있다
- [ ] 각 주문의 주문 번호, 총 금액, 상태, 주문 일시를 확인할 수 있다
- [ ] 주문 상태(결제완료, 취소됨 등)를 구분할 수 있다

---

### US-O-003: 주문 상세 조회
**As a** 고객  
**I want** 특정 주문의 상세 정보를 조회할 수 있기를  
**So that** 주문한 상품과 결제 정보를 확인할 수 있다

**Acceptance Criteria:**
- [ ] 주문에 포함된 모든 상품을 확인할 수 있다
- [ ] 각 상품의 이름, 가격, 수량을 볼 수 있다
- [ ] 사용한 쿠폰과 할인 금액을 확인할 수 있다
- [ ] 최종 결제 금액을 확인할 수 있다

---

### US-O-004: 주문 전체 취소
**As a** 고객  
**I want** 주문 전체를 취소하고 환불받을 수 있기를  
**So that** 구매를 철회할 수 있다

**Acceptance Criteria:**
- [ ] 결제 완료된 주문을 취소할 수 있다
- [ ] 취소 시 모든 상품의 재고가 복원된다
- [ ] 취소 시 결제한 포인트가 전액 환불된다
- [ ] 취소 시 사용한 쿠폰이 다시 사용 가능해진다
- [ ] 취소된 주문은 '취소됨' 상태로 표시된다

---

### US-O-005: 주문 상품 개별 취소
**As a** 고객  
**I want** 주문 내 특정 상품만 취소하고 부분 환불받을 수 있기를  
**So that** 일부 상품만 구매를 철회할 수 있다

**Acceptance Criteria:**
- [ ] 주문 내 원하는 상품만 선택하여 취소할 수 있다
- [ ] 취소한 상품의 재고가 복원된다
- [ ] 취소한 상품 금액만큼 포인트가 환불된다
- [ ] 취소되지 않은 다른 상품은 정상 상태를 유지한다
- [ ] 개별 취소된 상품은 '취소됨' 상태로 표시된다

---

## Epic 6: 시스템 안정성

### US-SYS-001: 데이터 정합성 보장
**As a** 시스템  
**I want** 주문 처리 중 모든 작업이 원자적으로 처리되기를  
**So that** 데이터 불일치가 발생하지 않는다

**Acceptance Criteria:**
- [ ] 주문 생성 시 재고 차감, 포인트 차감, 쿠폰 사용이 모두 성공하거나 모두 실패한다
- [ ] 주문 취소 시 재고 복원, 포인트 환불, 쿠폰 복원이 모두 성공하거나 모두 실패한다
- [ ] 처리 중 오류 발생 시 모든 변경사항이 롤백된다

---

### US-SYS-002: 동시성 제어
**As a** 시스템  
**I want** 동시 다발적인 요청을 안전하게 처리하기를  
**So that** 재고 초과 판매나 쿠폰 초과 발급이 발생하지 않는다

**Acceptance Criteria:**
- [ ] 동시에 같은 쿠폰을 발급 요청해도 정확한 수량만 발급된다
- [ ] 동시에 같은 상품을 주문해도 재고를 초과하여 판매되지 않는다
- [ ] 동시에 포인트를 사용해도 잔액이 음수가 되지 않는다

---

### US-SYS-003: 외부 시스템 연동
**As a** 시스템  
**I want** 주문 데이터를 외부 시스템에 전송하기를  
**So that** 다른 시스템과 데이터를 공유할 수 있다

**Acceptance Criteria:**
- [ ] 주문 완료 시 Outbox 테이블에 데이터가 기록된다
- [ ] 외부 전송이 실패해도 주문은 정상 처리된다
- [ ] 전송 실패한 데이터는 재시도 가능하다

---

## 우선순위별 분류

### P0 (최우선 - MVP 필수)
- US-O-001: 주문 생성
- US-O-004: 주문 전체 취소
- US-P-001: 포인트 충전
- US-PR-001: 상품 목록 조회
- US-CA-001: 장바구니 상품 추가
- US-SYS-001: 데이터 정합성 보장

### P1 (높음 - MVP 포함)
- US-C-001: 선착순 쿠폰 발급
- US-O-005: 주문 상품 개별 취소
- US-PR-003: 실시간 재고 조회
- US-CA-002: 장바구니 수량 변경
- US-SYS-002: 동시성 제어

### P2 (중간 - MVP 이후)
- US-P-002: 포인트 잔액 조회
- US-P-003: 포인트 거래 내역 조회
- US-C-002: 보유 쿠폰 조회
- US-O-002: 주문 목록 조회
- US-O-003: 주문 상세 조회
- US-CA-003: 장바구니 상품 삭제
- US-CA-004: 장바구니 조회

### P3 (낮음 - 향후 개선)
- US-SYS-003: 외부 시스템 연동
- US-PR-002: 상품 상세 조회

---